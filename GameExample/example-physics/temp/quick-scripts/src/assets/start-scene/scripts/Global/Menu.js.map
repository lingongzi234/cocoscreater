{"version":3,"sources":["assets/start-scene/scripts/Global/Menu.js"],"names":["i18n","require","SceneList","emptyFunc","event","stopPropagation","cc","Class","Component","properties","text","type","Label","readme","Node","mask","btnInfo","Button","btnBack","testList","ScrollView","uiCamera","Camera","onLoad","_isLoadingScene","showDebugDraw","game","addPersistRootNode","node","currentSceneUrl","contentPos","isMenu","loadInstruction","zIndex","content","sceneList","getComponent","init","director","on","Director","EVENT_AFTER_SCENE_LAUNCH","_onSceneLaunched","cameras","i","l","length","camera","cullingMask","groupIndex","backToList","showReadme","loadScene","onLoadSceneFinish","bind","url","getContentPosition","active","setContentPosition","self","urlArr","split","fileName","replace","loader","loadRes","err","txt","string","t","undefined","off","labelTxt","find","textKey","enabledDebugDraw","getCollisionManager","videoPlayer"],"mappings":"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","sourceRoot":"/","sourcesContent":["const i18n = require('i18n');\nconst SceneList = require('SceneList');\n\nvar emptyFunc = function (event) {\n    event.stopPropagation();\n};\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        text: {\n            default: null,\n            type: cc.Label\n        },\n        readme: {\n            default: null,\n            type: cc.Node\n        },\n        mask: {\n            default: null,\n            type: cc.Node\n        },\n        btnInfo: {\n            default: null,\n            type: cc.Button\n        },\n        btnBack: {\n            default: null,\n            type: cc.Button\n        },\n        testList: {\n            default: null,\n            type: cc.ScrollView\n        },\n\n        uiCamera: {\n            default: null,\n            type: cc.Camera\n        }\n    },\n\n    onLoad: function () {\n        this._isLoadingScene = false;\n        this.showDebugDraw = false;\n        cc.game.addPersistRootNode(this.node);\n        this.currentSceneUrl = 'TestList.fire';\n        this.contentPos = null;\n        this.isMenu = true;\n        this.loadInstruction(this.currentSceneUrl);\n        this.node.zIndex = 999;\n\n        cc.game.addPersistRootNode(this.testList.node);\n        if (this.testList && this.testList.content) {\n            // in main scene\n            this.sceneList = this.testList.content.getComponent('SceneList');\n            this.sceneList.init(this);\n        }\n\n        cc.director.on(cc.Director.EVENT_AFTER_SCENE_LAUNCH, this._onSceneLaunched, this);\n    },\n\n    _onSceneLaunched () {\n        let cameras = cc.Camera.cameras;\n        for (let i = 0, l = cameras.length; i < l; i++) {\n            let camera = cameras[i];\n            if (camera === this.uiCamera) {\n                camera.cullingMask = 1 << this.node.groupIndex;\n            }\n            else {\n                camera.cullingMask = camera.cullingMask & (~(1 << this.node.groupIndex));\n            }\n        }\n    },\n    \n    backToList: function () {\n        if (this._isLoadingScene) {\n            return;\n        }\n        this._isLoadingScene = true;\n        this.showReadme(null, false);\n        this.currentSceneUrl = 'TestList.fire';\n        this.isMenu = true;\n        cc.director.loadScene('TestList', this.onLoadSceneFinish.bind(this));\n    },\n\n    loadScene: function (url) {\n        this._isLoadingScene = true;\n        this.contentPos = this.testList.getContentPosition();\n        this.currentSceneUrl = url;\n        this.isMenu = false;\n        this.testList.node.active = false;\n        cc.director.loadScene(url, this.onLoadSceneFinish.bind(this));\n    },\n\n    onLoadSceneFinish: function () {\n        let url = this.currentSceneUrl;\n        this.loadInstruction(url);\n        this.testList.node.active = false;\n        if (this.isMenu && this.contentPos) {\n            this.testList.node.active = true;\n            this.testList.setContentPosition(this.contentPos);\n        }\n        this._isLoadingScene = false;\n    },\n\n    loadInstruction: function (url) {\n        let self = this;\n        let urlArr = url.split('/');\n        let fileName = urlArr[urlArr.length - 1].replace('.fire', '');\n        cc.loader.loadRes('readme/' + fileName, function(err, txt) {\n            if (err) {\n                self.text.string = i18n.t(\"scripts/Global/Menu.js.1\");\n                return;\n            }\n            self.text.string = txt;\n        });\n    },\n\n    showReadme: function (event, active) {\n        if (active === undefined) {\n            this.readme.active = !this.readme.active;\n        }\n        else {\n            this.readme.active = active;\n        }\n        if (this.readme.active) {\n            this.mask.on('touchstart', emptyFunc, this);\n        } else {\n            this.mask.off('touchstart', emptyFunc, this);\n        }\n        let labelTxt = this.readme.active ? '关闭说明' : '查看说明';\n        cc.find('label', this.btnInfo.node).getComponent(cc.Label).textKey = labelTxt;\n\n        // en: fix Collider DebugDraw always displayed on top of the problem.\n        // zh：解决 Collider DebugDraw 一直显示在最上层的问题。\n        var enabledDebugDraw = cc.director.getCollisionManager().enabledDebugDraw;\n        if (this.readme.active) {\n            this.showDebugDraw = enabledDebugDraw;\n            cc.director.getCollisionManager().enabledDebugDraw = false;\n        }\n        else {\n            cc.director.getCollisionManager().enabledDebugDraw = this.showDebugDraw;\n        }\n        // en: fix Video Player always displayed on top of the problem.\n        // zh：修复 Video Player 一直显示在最上层的问题。\n        var videoPlayer = cc.find('Canvas/VideoPlayer');\n        if (videoPlayer) {\n            videoPlayer.active = !this.readme.active;\n        }\n    }\n});\n"]}