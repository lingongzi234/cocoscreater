{"version":3,"sources":["assets/cases/demo/blob/blob.js"],"names":["smooth","require","cc","Class","Component","properties","particleNumber","particleRadius","sphereSize","init","ctx","getComponent","Graphics","lineWidth","strokeColor","color","fromHEX","fillColor","x","node","y","particleAngle","Math","PI","particleDistance","sin","spheres","push","_createSphere","i","angle","posX","cos","posY","sphere","joint","addComponent","DistanceJoint","connectedBody","distance","dampingRatio","frequency","length","parent","r","Node","body","RigidBody","collider","PhysicsCircleCollider","density","restitution","friction","radius","emitTo","target","selfX","selfY","sqrt","velocity","v2","normalizeSelf","mulSelf","forEach","linearVelocity","update","dt","points","map","expandPosition","position","shift","result","firstControlPoints","secondControlPoints","pos","clear","moveTo","len","firstControlPoint","secondControlPoint","bezierCurveTo","close","fill","stroke","mul"],"mappings":"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","sourceRoot":"/","sourcesContent":["\nvar smooth = require('smooth');\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        particleNumber: 12,\n        particleRadius: 30,\n        sphereSize: 12\n    },\n\n    // use this for initialization\n    init: function () {\n        this.ctx = this.getComponent(cc.Graphics);\n\n        this.ctx.lineWidth = 6;\n        this.ctx.strokeColor = cc.color().fromHEX('#495069');\n        this.ctx.fillColor = cc.color().fromHEX('#ffde59');\n\n        let x = this.node.x;\n        let y = this.node.y;\n\n        let particleNumber = this.particleNumber;\n        let particleRadius = this.particleRadius;\n        let sphereSize = this.sphereSize;\n\n        let particleAngle = (2*Math.PI)/particleNumber;\n        let particleDistance = Math.sin(particleAngle) * particleRadius * Math.sin((Math.PI - particleAngle)/2);\n\n        let spheres = [];\n        spheres.push( this._createSphere(0, 0, sphereSize, this.node) );\n\n        for (let i=0; i<particleNumber; i++) {\n            let angle = particleAngle*i;\n            let posX = particleRadius * Math.cos(angle);\n            let posY = particleRadius * Math.sin(angle);\n            let sphere = this._createSphere(posX, posY, sphereSize);\n            spheres.push( sphere );\n            \n            let joint = sphere.node.addComponent(cc.DistanceJoint);\n            joint.connectedBody = spheres[0];\n            joint.distance = particleRadius;\n            joint.dampingRatio = 0.5;\n            joint.frequency = 4;\n\n            if (i > 0) {\n                joint = sphere.node.addComponent(cc.DistanceJoint);\n                joint.connectedBody = spheres[spheres.length - 2];\n                joint.distance = particleDistance;\n                joint.dampingRatio = 1;\n                joint.frequency = 0;\n            }\n\n            if (i === particleNumber - 1) {\n                joint = spheres[1].node.addComponent(cc.DistanceJoint);\n                joint.connectedBody = sphere;\n                joint.distance = particleDistance;\n                joint.dampingRatio = 1;\n                joint.frequency = 0;\n            }\n\n            sphere.node.parent = this.node;\n        }\n\n        this.spheres = spheres;\n    },\n\n    _createSphere (x, y, r, node) {\n        if (!node) {\n            node = new cc.Node();\n            node.x = x;\n            node.y = y;\n        }\n\n        let body = node.addComponent(cc.RigidBody);\n\n        let collider = node.addComponent(cc.PhysicsCircleCollider);\n        collider.density = 1;\n        collider.restitution = 0.4;\n        collider.friction = 0.5;\n        collider.radius = r;\n\n        return body;\n    },\n\n    emitTo (target) {\n        var x = target.x;\n        var y = target.y;\n\n        var selfX = this.node.x;\n        var selfY = this.node.y;\n\n        var distance = Math.sqrt((x-selfX)*(x-selfX) + (y-selfY)*(y-selfY));\n        var velocity = cc.v2(x-selfX, y-selfY);\n        velocity.normalizeSelf();\n        velocity.mulSelf(distance*2);\n\n        this.spheres.forEach(function (sphere) {\n            sphere.linearVelocity = velocity;\n        });\n    },\n\n    update (dt) {\n        var ctx = this.ctx;\n\n        var points = this.spheres.map(sphere => {\n            return this.expandPosition( sphere.node.position );\n        });\n\n        points.shift();\n\n        var result = smooth( points );\n        var firstControlPoints = result[0];\n        var secondControlPoints = result[1];\n\n        var pos = points[0];\n\n        ctx.clear();\n        ctx.moveTo(pos.x, pos.y);\n\n        for (var i = 1, len = points.length; i < len; i++) {\n            var firstControlPoint = firstControlPoints[i - 1],\n                secondControlPoint = secondControlPoints[i - 1];\n\n            ctx.bezierCurveTo(\n                firstControlPoint.x, firstControlPoint.y,\n                secondControlPoint.x, secondControlPoint.y,\n                points[i].x, points[i].y\n            );\n        }\n\n        ctx.close();\n        ctx.fill();\n        ctx.stroke();\n    },\n\n    expandPosition (pos) {\n        return pos.mul(1.3);\n    }\n});\n"]}