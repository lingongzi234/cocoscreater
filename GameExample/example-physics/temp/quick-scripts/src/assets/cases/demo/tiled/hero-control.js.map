{"version":3,"sources":["assets/cases/demo/tiled/hero-control.js"],"names":["MOVE_LEFT","MOVE_RIGHT","cc","macro","ENABLE_TILEDMAP_CULLING","Class","Component","properties","maxSpeed","jumps","acceleration","jumpSpeed","drag","onLoad","systemEvent","on","SystemEvent","EventType","KEY_DOWN","onKeyDown","KEY_UP","onKeyUp","_moveFlags","_up","body","getComponent","RigidBody","event","keyCode","KEY","a","left","d","right","up","_upPressed","update","dt","speed","linearVelocity","node","scaleX","x","Math","abs","y"],"mappings":"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","sourceRoot":"/","sourcesContent":["// game art from : https://openpixelproject.itch.io/opp2017sprites\n\nconst MOVE_LEFT = 1;\nconst MOVE_RIGHT = 2;\n\ncc.macro.ENABLE_TILEDMAP_CULLING = false;\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        maxSpeed: 500,\n        jumps: 2,\n        acceleration: 1500,\n        jumpSpeed: 200,\n        drag: 600\n    },\n\n    // use this for initialization\n    onLoad: function () {\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\n\n        this._moveFlags = 0;\n\n        this._up = false;\n        \n        this.body = this.getComponent(cc.RigidBody);\n    },\n\n    onKeyDown (event) {\n        switch(event.keyCode) {\n            case cc.KEY.a:\n            case cc.KEY.left:\n                this._moveFlags |= MOVE_LEFT;\n                break;\n            case cc.KEY.d:\n            case cc.KEY.right:\n                this._moveFlags |= MOVE_RIGHT;\n                break;\n            case cc.KEY.up:\n                if (!this._upPressed) {\n                    this._up = true;\n                }\n                this._upPressed = true;\n                break;\n        }\n    },\n\n    onKeyUp (event) {\n        switch(event.keyCode) {\n            case cc.KEY.a:\n            case cc.KEY.left:\n                this._moveFlags &= ~MOVE_LEFT;\n                break;\n            case cc.KEY.d:\n            case cc.KEY.right:\n                this._moveFlags &= ~MOVE_RIGHT;\n                break;\n            case cc.KEY.up:\n                this._upPressed = false;\n                break;\n        }\n    },\n\n\n    // called every frame, uncomment this function to activate update callback\n    update: function (dt) {\n        var speed = this.body.linearVelocity;\n\n        if(this._moveFlags === MOVE_LEFT) {\n            // this.anim.play('walk');\n\n            if(this.node.scaleX > 0) {\n                this.node.scaleX *= -1;\n            }\n\n            speed.x -= this.acceleration * dt;\n            if(speed.x < -this.maxSpeed) {\n                speed.x = -this.maxSpeed;\n            }\n        } \n        else if (this._moveFlags === MOVE_RIGHT) {\n            // this.anim.play('walk');\n\n            if(this.node.scaleX < 0) {\n                this.node.scaleX *= -1;\n            }\n\n            speed.x += this.acceleration * dt;\n            if(speed.x > this.maxSpeed) {\n                speed.x = this.maxSpeed;\n            }\n        }  \n        else {\n            if(speed.x != 0) {\n                var d = this.drag * dt;\n                if(Math.abs(speed.x) <= d) {\n                    speed.x = 0;\n                    // this.anim.play('idle');\n                } else {\n                    speed.x -= speed.x > 0 ? d : -d;\n                }\n            }\n        }\n        \n        if(Math.abs(speed.y) < 1) {\n            this.jumps   = 2;\n        }\n\n        if (this.jumps > 0 && this._up) {\n            speed.y = this.jumpSpeed;\n            this.jumps--;\n        }\n\n        this._up = false;\n        this.body.linearVelocity = speed;\n    },\n});\n"]}