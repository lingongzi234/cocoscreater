{"version":3,"sources":["assets/cases/demo/stick-arrow/arrow.js"],"names":["cc","Class","Component","onLoad","weldJoint","getComponent","WeldJoint","onPostSolve","contact","selfCollider","otherCollider","impulse","getImpulse","Math","abs","normalImpulses","PhysicsManager","PTM_RATIO","joint","enabled","node","name","arrowBody","body","targetBody","worldCoordsAnchorPoint","getWorldPoint","v2","connectedBody","anchor","getLocalPoint","connectedAnchor","referenceAngle","rotation"],"mappings":";;;;;;AAAA;AACA;AAEAA,EAAE,CAACC,KAAH,CAAS;EACL,WAASD,EAAE,CAACE,SADP;EAGLC,MAAM,EAAE,kBAAY;IAChB,KAAKC,SAAL,GAAiB,KAAKC,YAAL,CAAkBL,EAAE,CAACM,SAArB,CAAjB;EACH,CALI;EAOLC,WAAW,EAAE,qBAAUC,OAAV,EAAmBC,YAAnB,EAAiCC,aAAjC,EAAgD;IACzD,IAAIC,OAAO,GAAGH,OAAO,CAACI,UAAR,EAAd;IACA,IAAIC,IAAI,CAACC,GAAL,CAASH,OAAO,CAACI,cAAR,CAAuB,CAAvB,CAAT,IAAsCf,EAAE,CAACgB,cAAH,CAAkBC,SAA5D,EAAuE;IAEvE,IAAIC,KAAK,GAAG,KAAKd,SAAjB;;IAEA,IAAIc,KAAK,CAACC,OAAV,EAAmB;MACfD,KAAK,CAACC,OAAN,GAAgB,KAAhB;MACA;IACH;;IAED,IAAIT,aAAa,CAACU,IAAd,CAAmBC,IAAnB,KAA4B,OAAhC,EAAyC;MACrC;IACH;;IAED,IAAIC,SAAS,GAAGb,YAAY,CAACc,IAA7B;IACA,IAAIC,UAAU,GAAGd,aAAa,CAACa,IAA/B;IACA,IAAIE,sBAAsB,GAAGH,SAAS,CAACI,aAAV,CAAyB1B,EAAE,CAAC2B,EAAH,CAAM,GAAN,EAAW,CAAX,CAAzB,CAA7B;IAEAT,KAAK,CAACU,aAAN,GAAsBJ,UAAtB;IACAN,KAAK,CAACW,MAAN,GAAeP,SAAS,CAACQ,aAAV,CAAyBL,sBAAzB,CAAf;IACAP,KAAK,CAACa,eAAN,GAAwBP,UAAU,CAACM,aAAX,CAA0BL,sBAA1B,CAAxB;IACAP,KAAK,CAACc,cAAN,GAAuBR,UAAU,CAACJ,IAAX,CAAgBa,QAAhB,GAA2BX,SAAS,CAACF,IAAV,CAAea,QAAjE;IAEAf,KAAK,CAACC,OAAN,GAAgB,IAAhB;EACH;AAhCI,CAAT","sourceRoot":"/","sourcesContent":["// http://www.iforce2d.net/b2dtut/sticky-projectiles\n// http://www.emanueleferonato.com/2012/12/14/box2d-flying-arrow-engine-first-attempt/\n\ncc.Class({\n    extends: cc.Component,\n\n    onLoad: function () {\n        this.weldJoint = this.getComponent(cc.WeldJoint);\n    },\n\n    onPostSolve: function (contact, selfCollider, otherCollider) {\n        var impulse = contact.getImpulse();\n        if (Math.abs(impulse.normalImpulses[0]) < cc.PhysicsManager.PTM_RATIO) return;\n\n        let joint = this.weldJoint;\n\n        if (joint.enabled) {\n            joint.enabled = false;\n            return;\n        }\n\n        if (otherCollider.node.name === 'arrow') {\n            return;\n        }\n\n        let arrowBody = selfCollider.body;\n        let targetBody = otherCollider.body;\n        let worldCoordsAnchorPoint = arrowBody.getWorldPoint( cc.v2(0.6, 0) );\n    \n        joint.connectedBody = targetBody;\n        joint.anchor = arrowBody.getLocalPoint( worldCoordsAnchorPoint );\n        joint.connectedAnchor = targetBody.getLocalPoint( worldCoordsAnchorPoint );\n        joint.referenceAngle = targetBody.node.rotation - arrowBody.node.rotation;\n\n        joint.enabled = true;\n    }\n});\n"]}