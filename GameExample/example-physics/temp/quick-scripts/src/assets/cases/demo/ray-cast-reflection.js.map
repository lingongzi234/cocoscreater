{"version":3,"sources":["assets/cases/demo/ray-cast-reflection.js"],"names":["cc","Class","Component","properties","radius","onLoad","ctx","getComponent","Graphics","angle","center","v2","winSize","width","height","update","dt","Math","PI","p1","p2","cos","sin","mulSelf","addSelf","clear","remainLength","rayCast","manager","director","getPhysicsManager","result","point","circle","x","y","fill","moveTo","lineTo","stroke","sub","mag","normal","mul","add"],"mappings":";;;;;;AAAAA,EAAE,CAACC,KAAH,CAAS;EACL,WAASD,EAAE,CAACE,SADP;EAGLC,UAAU,EAAE;IACRC,MAAM,EAAE;EADA,CAHP;EAOL;EACAC,MAAM,EAAE,kBAAY;IAChB,KAAKC,GAAL,GAAW,KAAKC,YAAL,CAAkBP,EAAE,CAACQ,QAArB,CAAX;IACA,KAAKC,KAAL,GAAa,CAAb;IACA,KAAKC,MAAL,GAAcV,EAAE,CAACW,EAAH,CAAMX,EAAE,CAACY,OAAH,CAAWC,KAAX,GAAiB,CAAvB,EAA0Bb,EAAE,CAACY,OAAH,CAAWE,MAAX,GAAkB,CAA5C,CAAd;EACH,CAZI;EAcL;EACAC,MAAM,EAAE,gBAAUC,EAAV,EAAc;IAClB,KAAKP,KAAL,IAAcQ,IAAI,CAACC,EAAL,GAAU,EAAV,GAAeF,EAA7B;IAEA,IAAIG,EAAE,GAAG,KAAKT,MAAd;IACA,IAAIU,EAAE,GAAGpB,EAAE,CAACW,EAAH,CAAMM,IAAI,CAACI,GAAL,CAAS,KAAKZ,KAAd,CAAN,EAA4BQ,IAAI,CAACK,GAAL,CAAS,KAAKb,KAAd,CAA5B,EAAkDc,OAAlD,CAA0D,KAAKnB,MAA/D,EAAuEoB,OAAvE,CAAgF,KAAKd,MAArF,CAAT;IAEA,KAAKJ,GAAL,CAASmB,KAAT;IAEA,KAAKC,YAAL,GAAoB,KAAKtB,MAAzB;IACA,KAAKuB,OAAL,CAAaR,EAAb,EAAiBC,EAAjB;EACH,CAzBI;EA2BLO,OAAO,EAAE,iBAAUR,EAAV,EAAcC,EAAd,EAAkB;IACvB,IAAIQ,OAAO,GAAG5B,EAAE,CAAC6B,QAAH,CAAYC,iBAAZ,EAAd;IACA,IAAIC,MAAM,GAAGH,OAAO,CAACD,OAAR,CAAgBR,EAAhB,EAAoBC,EAApB,EAAwB,CAAxB,CAAb;;IAEA,IAAIW,MAAJ,EAAY;MACRX,EAAE,GAAGW,MAAM,CAACC,KAAZ;MACA,KAAK1B,GAAL,CAAS2B,MAAT,CAAgBb,EAAE,CAACc,CAAnB,EAAsBd,EAAE,CAACe,CAAzB,EAA4B,CAA5B;MACA,KAAK7B,GAAL,CAAS8B,IAAT;IACH;;IAED,KAAK9B,GAAL,CAAS+B,MAAT,CAAgBlB,EAAE,CAACe,CAAnB,EAAsBf,EAAE,CAACgB,CAAzB;IACA,KAAK7B,GAAL,CAASgC,MAAT,CAAgBlB,EAAE,CAACc,CAAnB,EAAsBd,EAAE,CAACe,CAAzB;IACA,KAAK7B,GAAL,CAASiC,MAAT;IAEA,IAAI,CAACR,MAAL,EAAa;IAEb,KAAKL,YAAL,GAAoB,KAAKA,YAAL,GAAoBN,EAAE,CAACoB,GAAH,CAAOrB,EAAP,EAAWsB,GAAX,EAAxC;IACA,IAAI,KAAKf,YAAL,GAAoB,CAAxB,EAA2B;IAE3BK,MAAM,CAACW,MAAP,CAAcC,GAAd,CAAkB,KAAKjB,YAAvB;IAEAP,EAAE,GAAGC,EAAL;IACAA,EAAE,GAAGW,MAAM,CAACW,MAAP,CAAcC,GAAd,CAAkB,KAAKjB,YAAvB,EAAqCkB,GAArC,CAAyCzB,EAAzC,CAAL;IACA,KAAKQ,OAAL,CAAaR,EAAb,EAAiBC,EAAjB;EACH;AAnDI,CAAT","sourceRoot":"/","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        radius: 1000\n    },\n\n    // use this for initialization\n    onLoad: function () {\n        this.ctx = this.getComponent(cc.Graphics);\n        this.angle = 0;\n        this.center = cc.v2(cc.winSize.width/2, cc.winSize.height/2);\n    },\n\n    // called every frame, uncomment this function to activate update callback\n    update: function (dt) {\n        this.angle += Math.PI / 20 * dt;\n\n        var p1 = this.center;\n        var p2 = cc.v2(Math.cos(this.angle), Math.sin(this.angle)).mulSelf(this.radius).addSelf( this.center );\n\n        this.ctx.clear();\n    \n        this.remainLength = this.radius;\n        this.rayCast(p1, p2);\n    },\n\n    rayCast: function (p1, p2) {\n        var manager = cc.director.getPhysicsManager();\n        var result = manager.rayCast(p1, p2)[0];\n\n        if (result) {\n            p2 = result.point;\n            this.ctx.circle(p2.x, p2.y, 5);\n            this.ctx.fill();\n        }\n\n        this.ctx.moveTo(p1.x, p1.y);\n        this.ctx.lineTo(p2.x, p2.y);\n        this.ctx.stroke();\n\n        if (!result) return;\n\n        this.remainLength = this.remainLength - p2.sub(p1).mag();\n        if (this.remainLength < 1) return;\n\n        result.normal.mul(this.remainLength);\n\n        p1 = p2;\n        p2 = result.normal.mul(this.remainLength).add(p1);\n        this.rayCast(p1, p2);\n    }\n});\n"]}