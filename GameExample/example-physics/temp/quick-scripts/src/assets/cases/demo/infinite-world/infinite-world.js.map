{"version":3,"sources":["assets/cases/demo/infinite-world/infinite-world.js"],"names":["cc","Class","Component","properties","pixelStep","xOffset","yOffset","target","type","Node","onLoad","hills","pools","generateHill","generateHillPiece","points","first","x","node","collider","apply","push","shift","body","addComponent","RigidBody","RigidBodyType","Static","PhysicsPolygonCollider","friction","parent","hillWidth","Math","ceil","random","numberOfSlices","j","randomHeight","min","v2","cos","PI","update","dt"],"mappings":"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","sourceRoot":"/","sourcesContent":["// http://www.emanueleferonato.com/2011/10/04/create-a-terrain-like-the-one-in-tiny-wings-with-flash-and-box2d-%E2%80%93-adding-more-bumps/\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        pixelStep: 10,\n        xOffset: 0,\n        yOffset: 240,\n\n        target: {\n            default: null,\n            type: cc.Node\n        }\n    },\n\n    // use this for initialization\n    onLoad: function () {\n        this.hills = [];\n        this.pools = [];\n\n        while (this.xOffset < 1200) {\n            this.generateHill(10);\n        }\n    },\n\n    generateHillPiece (xOffset, points) {\n        let hills = this.hills;\n\n        let first = hills[0];\n        if (first && (this.target.x - first.node.x > 1000)) {\n            first.node.x = xOffset;\n            first.collider.points = points;\n            first.collider.apply();\n            hills.push( hills.shift() );\n            return;\n        }\n\n        let node = new cc.Node();\n        node.x = xOffset;\n\n        let body = node.addComponent(cc.RigidBody);\n        body.type = cc.RigidBodyType.Static;\n\n        let collider = node.addComponent(cc.PhysicsPolygonCollider);\n        collider.points = points;\n        collider.friction = 1;\n\n        node.parent = this.node;\n\n        hills.push( {node: node, collider: collider} );\n    },\n\n    generateHill () {\n        let pixelStep = this.pixelStep;\n        let xOffset = this.xOffset;\n        let yOffset = this.yOffset;\n\n        let hillWidth = 120 + Math.ceil(Math.random()*26)*20;\n        let numberOfSlices = hillWidth/pixelStep;\n\n        let j;\n\n        // first step\n        let randomHeight;\n        if (xOffset === 0) {\n            randomHeight = 0;\n        }\n        else {\n            randomHeight = Math.min( Math.random() * hillWidth / 7.5,  600 - yOffset); // make sure yOffset < 600\n        }\n        \n        yOffset += randomHeight;\n\n        for (j = 0; j < numberOfSlices/2; j++) {\n            let points = [];\n            points.push( cc.v2( 0,     0) );\n            points.push( cc.v2( 0,     yOffset - randomHeight*Math.cos(2*Math.PI/numberOfSlices*j)) );\n            points.push( cc.v2( pixelStep, yOffset - randomHeight*Math.cos(2*Math.PI/numberOfSlices*(j+1))) );\n            points.push( cc.v2( pixelStep, 0) );\n\n            this.generateHillPiece(xOffset+ j*pixelStep, points);\n        }\n        \n        yOffset += randomHeight;\n        \n        // second step\n        if (xOffset === 0) {\n            randomHeight = 0;\n        }\n        else {\n            randomHeight = Math.min( Math.random()*hillWidth/5,  yOffset - 240); // make sure yOffset > 240\n        }\n\n        yOffset -= randomHeight;\n\n        for (j = numberOfSlices/2; j < numberOfSlices; j++) {\n            let points = [];\n            points.push( cc.v2( 0,     0) );\n            points.push( cc.v2( 0,     yOffset - randomHeight*Math.cos(2*Math.PI/numberOfSlices*j)) );\n            points.push( cc.v2( pixelStep, yOffset - randomHeight*Math.cos(2*Math.PI/numberOfSlices*(j+1))) );\n            points.push( cc.v2( pixelStep, 0) );\n\n            this.generateHillPiece(xOffset+ j*pixelStep, points);\n        }\n        yOffset -= randomHeight;\n\n        this.xOffset += hillWidth;\n        this.yOffset = yOffset;\n    },\n\n    // called every frame, uncomment this function to activate update callback\n    update: function (dt) {\n        if (!this.target) return;\n\n        while (this.target.x + 1200 > this.xOffset) {\n            this.generateHill();\n        }\n    },\n});\n"]}