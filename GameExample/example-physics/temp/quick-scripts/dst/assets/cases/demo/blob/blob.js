
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/cases/demo/blob/blob.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '4960bicKTtO84ujLGfekh0N', 'blob');
// cases/demo/blob/blob.js

"use strict";

var smooth = require('smooth');

cc.Class({
  "extends": cc.Component,
  properties: {
    particleNumber: 12,
    particleRadius: 30,
    sphereSize: 12
  },
  // use this for initialization
  init: function init() {
    this.ctx = this.getComponent(cc.Graphics);
    this.ctx.lineWidth = 6;
    this.ctx.strokeColor = cc.color().fromHEX('#495069');
    this.ctx.fillColor = cc.color().fromHEX('#ffde59');
    var x = this.node.x;
    var y = this.node.y;
    var particleNumber = this.particleNumber;
    var particleRadius = this.particleRadius;
    var sphereSize = this.sphereSize;
    var particleAngle = 2 * Math.PI / particleNumber;
    var particleDistance = Math.sin(particleAngle) * particleRadius * Math.sin((Math.PI - particleAngle) / 2);
    var spheres = [];
    spheres.push(this._createSphere(0, 0, sphereSize, this.node));

    for (var i = 0; i < particleNumber; i++) {
      var angle = particleAngle * i;
      var posX = particleRadius * Math.cos(angle);
      var posY = particleRadius * Math.sin(angle);

      var sphere = this._createSphere(posX, posY, sphereSize);

      spheres.push(sphere);
      var joint = sphere.node.addComponent(cc.DistanceJoint);
      joint.connectedBody = spheres[0];
      joint.distance = particleRadius;
      joint.dampingRatio = 0.5;
      joint.frequency = 4;

      if (i > 0) {
        joint = sphere.node.addComponent(cc.DistanceJoint);
        joint.connectedBody = spheres[spheres.length - 2];
        joint.distance = particleDistance;
        joint.dampingRatio = 1;
        joint.frequency = 0;
      }

      if (i === particleNumber - 1) {
        joint = spheres[1].node.addComponent(cc.DistanceJoint);
        joint.connectedBody = sphere;
        joint.distance = particleDistance;
        joint.dampingRatio = 1;
        joint.frequency = 0;
      }

      sphere.node.parent = this.node;
    }

    this.spheres = spheres;
  },
  _createSphere: function _createSphere(x, y, r, node) {
    if (!node) {
      node = new cc.Node();
      node.x = x;
      node.y = y;
    }

    var body = node.addComponent(cc.RigidBody);
    var collider = node.addComponent(cc.PhysicsCircleCollider);
    collider.density = 1;
    collider.restitution = 0.4;
    collider.friction = 0.5;
    collider.radius = r;
    return body;
  },
  emitTo: function emitTo(target) {
    var x = target.x;
    var y = target.y;
    var selfX = this.node.x;
    var selfY = this.node.y;
    var distance = Math.sqrt((x - selfX) * (x - selfX) + (y - selfY) * (y - selfY));
    var velocity = cc.v2(x - selfX, y - selfY);
    velocity.normalizeSelf();
    velocity.mulSelf(distance * 2);
    this.spheres.forEach(function (sphere) {
      sphere.linearVelocity = velocity;
    });
  },
  update: function update(dt) {
    var _this = this;

    var ctx = this.ctx;
    var points = this.spheres.map(function (sphere) {
      return _this.expandPosition(sphere.node.position);
    });
    points.shift();
    var result = smooth(points);
    var firstControlPoints = result[0];
    var secondControlPoints = result[1];
    var pos = points[0];
    ctx.clear();
    ctx.moveTo(pos.x, pos.y);

    for (var i = 1, len = points.length; i < len; i++) {
      var firstControlPoint = firstControlPoints[i - 1],
          secondControlPoint = secondControlPoints[i - 1];
      ctx.bezierCurveTo(firstControlPoint.x, firstControlPoint.y, secondControlPoint.x, secondControlPoint.y, points[i].x, points[i].y);
    }

    ctx.close();
    ctx.fill();
    ctx.stroke();
  },
  expandPosition: function expandPosition(pos) {
    return pos.mul(1.3);
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9jYXNlcy9kZW1vL2Jsb2IvYmxvYi5qcyJdLCJuYW1lcyI6WyJzbW9vdGgiLCJyZXF1aXJlIiwiY2MiLCJDbGFzcyIsIkNvbXBvbmVudCIsInByb3BlcnRpZXMiLCJwYXJ0aWNsZU51bWJlciIsInBhcnRpY2xlUmFkaXVzIiwic3BoZXJlU2l6ZSIsImluaXQiLCJjdHgiLCJnZXRDb21wb25lbnQiLCJHcmFwaGljcyIsImxpbmVXaWR0aCIsInN0cm9rZUNvbG9yIiwiY29sb3IiLCJmcm9tSEVYIiwiZmlsbENvbG9yIiwieCIsIm5vZGUiLCJ5IiwicGFydGljbGVBbmdsZSIsIk1hdGgiLCJQSSIsInBhcnRpY2xlRGlzdGFuY2UiLCJzaW4iLCJzcGhlcmVzIiwicHVzaCIsIl9jcmVhdGVTcGhlcmUiLCJpIiwiYW5nbGUiLCJwb3NYIiwiY29zIiwicG9zWSIsInNwaGVyZSIsImpvaW50IiwiYWRkQ29tcG9uZW50IiwiRGlzdGFuY2VKb2ludCIsImNvbm5lY3RlZEJvZHkiLCJkaXN0YW5jZSIsImRhbXBpbmdSYXRpbyIsImZyZXF1ZW5jeSIsImxlbmd0aCIsInBhcmVudCIsInIiLCJOb2RlIiwiYm9keSIsIlJpZ2lkQm9keSIsImNvbGxpZGVyIiwiUGh5c2ljc0NpcmNsZUNvbGxpZGVyIiwiZGVuc2l0eSIsInJlc3RpdHV0aW9uIiwiZnJpY3Rpb24iLCJyYWRpdXMiLCJlbWl0VG8iLCJ0YXJnZXQiLCJzZWxmWCIsInNlbGZZIiwic3FydCIsInZlbG9jaXR5IiwidjIiLCJub3JtYWxpemVTZWxmIiwibXVsU2VsZiIsImZvckVhY2giLCJsaW5lYXJWZWxvY2l0eSIsInVwZGF0ZSIsImR0IiwicG9pbnRzIiwibWFwIiwiZXhwYW5kUG9zaXRpb24iLCJwb3NpdGlvbiIsInNoaWZ0IiwicmVzdWx0IiwiZmlyc3RDb250cm9sUG9pbnRzIiwic2Vjb25kQ29udHJvbFBvaW50cyIsInBvcyIsImNsZWFyIiwibW92ZVRvIiwibGVuIiwiZmlyc3RDb250cm9sUG9pbnQiLCJzZWNvbmRDb250cm9sUG9pbnQiLCJiZXppZXJDdXJ2ZVRvIiwiY2xvc2UiLCJmaWxsIiwic3Ryb2tlIiwibXVsIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUNBLElBQUlBLE1BQU0sR0FBR0MsT0FBTyxDQUFDLFFBQUQsQ0FBcEI7O0FBRUFDLEVBQUUsQ0FBQ0MsS0FBSCxDQUFTO0VBQ0wsV0FBU0QsRUFBRSxDQUFDRSxTQURQO0VBR0xDLFVBQVUsRUFBRTtJQUNSQyxjQUFjLEVBQUUsRUFEUjtJQUVSQyxjQUFjLEVBQUUsRUFGUjtJQUdSQyxVQUFVLEVBQUU7RUFISixDQUhQO0VBU0w7RUFDQUMsSUFBSSxFQUFFLGdCQUFZO0lBQ2QsS0FBS0MsR0FBTCxHQUFXLEtBQUtDLFlBQUwsQ0FBa0JULEVBQUUsQ0FBQ1UsUUFBckIsQ0FBWDtJQUVBLEtBQUtGLEdBQUwsQ0FBU0csU0FBVCxHQUFxQixDQUFyQjtJQUNBLEtBQUtILEdBQUwsQ0FBU0ksV0FBVCxHQUF1QlosRUFBRSxDQUFDYSxLQUFILEdBQVdDLE9BQVgsQ0FBbUIsU0FBbkIsQ0FBdkI7SUFDQSxLQUFLTixHQUFMLENBQVNPLFNBQVQsR0FBcUJmLEVBQUUsQ0FBQ2EsS0FBSCxHQUFXQyxPQUFYLENBQW1CLFNBQW5CLENBQXJCO0lBRUEsSUFBSUUsQ0FBQyxHQUFHLEtBQUtDLElBQUwsQ0FBVUQsQ0FBbEI7SUFDQSxJQUFJRSxDQUFDLEdBQUcsS0FBS0QsSUFBTCxDQUFVQyxDQUFsQjtJQUVBLElBQUlkLGNBQWMsR0FBRyxLQUFLQSxjQUExQjtJQUNBLElBQUlDLGNBQWMsR0FBRyxLQUFLQSxjQUExQjtJQUNBLElBQUlDLFVBQVUsR0FBRyxLQUFLQSxVQUF0QjtJQUVBLElBQUlhLGFBQWEsR0FBSSxJQUFFQyxJQUFJLENBQUNDLEVBQVIsR0FBWWpCLGNBQWhDO0lBQ0EsSUFBSWtCLGdCQUFnQixHQUFHRixJQUFJLENBQUNHLEdBQUwsQ0FBU0osYUFBVCxJQUEwQmQsY0FBMUIsR0FBMkNlLElBQUksQ0FBQ0csR0FBTCxD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Q0FIM0I7SUFLSDs7SUFFRFYsR0FBRyxDQUFDd0UsS0FBSjtJQUNBeEUsR0FBRyxDQUFDeUUsSUFBSjtJQUNBekUsR0FBRyxDQUFDMEUsTUFBSjtFQUNILENBcElJO0VBc0lMZixjQXRJSywwQkFzSVdNLEdBdElYLEVBc0lnQjtJQUNqQixPQUFPQSxHQUFHLENBQUNVLEdBQUosQ0FBUSxHQUFSLENBQVA7RUFDSDtBQXhJSSxDQUFUIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJcbnZhciBzbW9vdGggPSByZXF1aXJlKCdzbW9vdGgnKTtcblxuY2MuQ2xhc3Moe1xuICAgIGV4dGVuZHM6IGNjLkNvbXBvbmVudCxcblxuICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgcGFydGljbGVOdW1iZXI6IDEyLFxuICAgICAgICBwYXJ0aWNsZVJhZGl1czogMzAsXG4gICAgICAgIHNwaGVyZVNpemU6IDEyXG4gICAgfSxcblxuICAgIC8vIHVzZSB0aGlzIGZvciBpbml0aWFsaXphdGlvblxuICAgIGluaXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5jdHggPSB0aGlzLmdldENvbXBvbmVudChjYy5HcmFwaGljcyk7XG5cbiAgICAgICAgdGhpcy5jdHgubGluZVdpZHRoID0gNjtcbiAgICAgICAgdGhpcy5jdHguc3Ryb2tlQ29sb3IgPSBjYy5jb2xvcigpLmZyb21IRVgoJyM0OTUwNjknKTtcbiAgICAgICAgdGhpcy5jdHguZmlsbENvbG9yID0gY2MuY29sb3IoKS5mcm9tSEVYKCcjZmZkZTU5Jyk7XG5cbiAgICAgICAgbGV0IHggPSB0aGlzLm5vZGUueDtcbiAgICAgICAgbGV0IHkgPSB0aGlzLm5vZGUueTtcblxuICAgICAgICBsZXQgcGFydGljbGVOdW1iZXIgPSB0aGlzLnBhcnRpY2xlTnVtYmVyO1xuICAgICAgICBsZXQgcGFydGljbGVSYWRpdXMgPSB0aGlzLnBhcnRpY2xlUmFkaXVzO1xuICAgICAgICBsZXQgc3BoZXJlU2l6ZSA9IHRoaXMuc3BoZXJlU2l6ZTtcblxuICAgICAgICBsZXQgcGFydGljbGVBbmdsZSA9ICgyKk1hdGguUEkpL3BhcnRpY2xlTnVtYmVyO1xuICAgICAgICBsZXQgcGFydGljbGVEaXN0YW5jZSA9IE1hdGguc2luKHBhcnRpY2xlQW5nbGUpICogcGFydGljbGVSYWRpdXMgKiBNYXRoLnNpbigoTWF0aC5QSSAtIHBhcnRpY2xlQW5nbGUpLzIpO1xuXG4gICAgICAgIGxldCBzcGhlcmVzID0gW107XG4gICAgICAgIHNwaGVyZXMucHVzaCggdGhpcy5fY3JlYXRlU3BoZXJlKDAsIDAsIHNwaGVyZVNpemUsIHRoaXMubm9kZSkgKTtcblxuICAgICAgICBmb3IgKGxldCBpPTA7IGk8cGFydGljbGVOdW1iZXI7IGkrKykge1xuICAgICAgICAgICAgbGV0IGFuZ2xlID0gcGFydGljbGVBbmdsZSppO1xuICAgICAgICAgICAgbGV0IHBvc1ggPSBwYXJ0aWNsZVJhZGl1cyAqIE1hdGguY29zKGFuZ2xlKTtcbiAgICAgICAgICAgIGxldCBwb3NZID0gcGFydGljbGVSYWRpdXMgKiBNYXRoLnNpbihhbmdsZSk7XG4gICAgICAgICAgICBsZXQgc3BoZXJlID0gdGhpcy5fY3JlYXRlU3BoZXJlKHBvc1gsIHBvc1ksIHNwaGVyZVNpemUpO1xuICAgICAgICAgICAgc3BoZXJlcy5wdXNoKCBzcGhlcmUgKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgbGV0IGpvaW50ID0gc3BoZXJlLm5vZGUuYWRkQ29tcG9uZW50KGNjLkRpc3RhbmNlSm9pbnQpO1xuICAgICAgICAgICAgam9pbnQuY29ubmVjdGVkQm9keSA9IHNwaGVyZXNbMF07XG4gICAgICAgICAgICBqb2ludC5kaXN0YW5jZSA9IHBhcnRpY2xlUmFkaXVzO1xuICAgICAgICAgICAgam9pbnQuZGFtcGluZ1JhdGlvID0gMC41O1xuICAgICAgICAgICAgam9pbnQuZnJlcXVlbmN5ID0gNDtcblxuICAgICAgICAgICAgaWYgKGkgPiAwKSB7XG4gICAgICAgICAgICAgICAgam9pbnQgPSBzcGhlcmUubm9kZS5hZGRDb21wb25lbnQoY2MuRGlzdGFuY2VKb2ludCk7XG4gICAgICAgICAgICAgICAgam9pbnQuY29ubmVjdGVkQm9keSA9IHNwaGVyZXNbc3BoZXJlcy5sZW5ndGggLSAyXTtcbiAgICAgICAgICAgICAgICBqb2ludC5kaXN0YW5jZSA9IHBhcnRpY2xlRGlzdGFuY2U7XG4gICAgICAgICAgICAgICAgam9pbnQuZGFtcGluZ1JhdGlvID0gMTtcbiAgICAgICAgICAgICAgICBqb2ludC5mcmVxdWVuY3kgPSAwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoaSA9PT0gcGFydGljbGVOdW1iZXIgLSAxKSB7XG4gICAgICAgICAgICAgICAgam9pbnQgPSBzcGhlcmVzWzFdLm5vZGUuYWRkQ29tcG9uZW50KGNjLkRpc3RhbmNlSm9pbnQpO1xuICAgICAgICAgICAgICAgIGpvaW50LmNvbm5lY3RlZEJvZHkgPSBzcGhlcmU7XG4gICAgICAgICAgICAgICAgam9pbnQuZGlzdGFuY2UgPSBwYXJ0aWNsZURpc3RhbmNlO1xuICAgICAgICAgICAgICAgIGpvaW50LmRhbXBpbmdSYXRpbyA9IDE7XG4gICAgICAgICAgICAgICAgam9pbnQuZnJlcXVlbmN5ID0gMDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc3BoZXJlLm5vZGUucGFyZW50ID0gdGhpcy5ub2RlO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5zcGhlcmVzID0gc3BoZXJlcztcbiAgICB9LFxuXG4gICAgX2NyZWF0ZVNwaGVyZSAoeCwgeSwgciwgbm9kZSkge1xuICAgICAgICBpZiAoIW5vZGUpIHtcbiAgICAgICAgICAgIG5vZGUgPSBuZXcgY2MuTm9kZSgpO1xuICAgICAgICAgICAgbm9kZS54ID0geDtcbiAgICAgICAgICAgIG5vZGUueSA9IHk7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgYm9keSA9IG5vZGUuYWRkQ29tcG9uZW50KGNjLlJpZ2lkQm9keSk7XG5cbiAgICAgICAgbGV0IGNvbGxpZGVyID0gbm9kZS5hZGRDb21wb25lbnQoY2MuUGh5c2ljc0NpcmNsZUNvbGxpZGVyKTtcbiAgICAgICAgY29sbGlkZXIuZGVuc2l0eSA9IDE7XG4gICAgICAgIGNvbGxpZGVyLnJlc3RpdHV0aW9uID0gMC40O1xuICAgICAgICBjb2xsaWRlci5mcmljdGlvbiA9IDAuNTtcbiAgICAgICAgY29sbGlkZXIucmFkaXVzID0gcjtcblxuICAgICAgICByZXR1cm4gYm9keTtcbiAgICB9LFxuXG4gICAgZW1pdFRvICh0YXJnZXQpIHtcbiAgICAgICAgdmFyIHggPSB0YXJnZXQueDtcbiAgICAgICAgdmFyIHkgPSB0YXJnZXQueTtcblxuICAgICAgICB2YXIgc2VsZlggPSB0aGlzLm5vZGUueDtcbiAgICAgICAgdmFyIHNlbGZZID0gdGhpcy5ub2RlLnk7XG5cbiAgICAgICAgdmFyIGRpc3RhbmNlID0gTWF0aC5zcXJ0KCh4LXNlbGZYKSooeC1zZWxmWCkgKyAoeS1zZWxmWSkqKHktc2VsZlkpKTtcbiAgICAgICAgdmFyIHZlbG9jaXR5ID0gY2MudjIoeC1zZWxmWCwgeS1zZWxmWSk7XG4gICAgICAgIHZlbG9jaXR5Lm5vcm1hbGl6ZVNlbGYoKTtcbiAgICAgICAgdmVsb2NpdHkubXVsU2VsZihkaXN0YW5jZSoyKTtcblxuICAgICAgICB0aGlzLnNwaGVyZXMuZm9yRWFjaChmdW5jdGlvbiAoc3BoZXJlKSB7XG4gICAgICAgICAgICBzcGhlcmUubGluZWFyVmVsb2NpdHkgPSB2ZWxvY2l0eTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIHVwZGF0ZSAoZHQpIHtcbiAgICAgICAgdmFyIGN0eCA9IHRoaXMuY3R4O1xuXG4gICAgICAgIHZhciBwb2ludHMgPSB0aGlzLnNwaGVyZXMubWFwKHNwaGVyZSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5leHBhbmRQb3NpdGlvbiggc3BoZXJlLm5vZGUucG9zaXRpb24gKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcG9pbnRzLnNoaWZ0KCk7XG5cbiAgICAgICAgdmFyIHJlc3VsdCA9IHNtb290aCggcG9pbnRzICk7XG4gICAgICAgIHZhciBmaXJzdENvbnRyb2xQb2ludHMgPSByZXN1bHRbMF07XG4gICAgICAgIHZhciBzZWNvbmRDb250cm9sUG9pbnRzID0gcmVzdWx0WzFdO1xuXG4gICAgICAgIHZhciBwb3MgPSBwb2ludHNbMF07XG5cbiAgICAgICAgY3R4LmNsZWFyKCk7XG4gICAgICAgIGN0eC5tb3ZlVG8ocG9zLngsIHBvcy55KTtcblxuICAgICAgICBmb3IgKHZhciBpID0gMSwgbGVuID0gcG9pbnRzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgZmlyc3RDb250cm9sUG9pbnQgPSBmaXJzdENvbnRyb2xQb2ludHNbaSAtIDFdLFxuICAgICAgICAgICAgICAgIHNlY29uZENvbnRyb2xQb2ludCA9IHNlY29uZENvbnRyb2xQb2ludHNbaSAtIDFdO1xuXG4gICAgICAgICAgICBjdHguYmV6aWVyQ3VydmVUbyhcbiAgICAgICAgICAgICAgICBmaXJzdENvbnRyb2xQb2ludC54LCBmaXJzdENvbnRyb2xQb2ludC55LFxuICAgICAgICAgICAgICAgIHNlY29uZENvbnRyb2xQb2ludC54LCBzZWNvbmRDb250cm9sUG9pbnQueSxcbiAgICAgICAgICAgICAgICBwb2ludHNbaV0ueCwgcG9pbnRzW2ldLnlcbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICBjdHguY2xvc2UoKTtcbiAgICAgICAgY3R4LmZpbGwoKTtcbiAgICAgICAgY3R4LnN0cm9rZSgpO1xuICAgIH0sXG5cbiAgICBleHBhbmRQb3NpdGlvbiAocG9zKSB7XG4gICAgICAgIHJldHVybiBwb3MubXVsKDEuMyk7XG4gICAgfVxufSk7XG4iXX0=