{"version":3,"sources":["assets/cases/demo/one-side-platform.js"],"names":["cc","Class","Component","properties","onLoad","pointVelPlatform","v2","pointVelOther","relativeVel","relativePoint","onBeginContact","contact","selfCollider","otherCollider","cache","_pointsCache","otherBody","body","platformBody","worldManifold","getWorldManifold","points","i","length","getLinearVelocityFromWorldPoint","getLocalVector","subSelf","y","getLocalPoint","platformFaceY","getAABB","height","disabled"],"mappings":";;;;;;AAAA;AAEAA,EAAE,CAACC,KAAH,CAAS;EACL,WAASD,EAAE,CAACE,SADP;EAGLC,UAAU,EAAE,EAHP;EAKLC,MAAM,EAAE,kBAAY;IAChB,KAAKC,gBAAL,GAAwBL,EAAE,CAACM,EAAH,EAAxB;IACA,KAAKC,aAAL,GAAqBP,EAAE,CAACM,EAAH,EAArB;IACA,KAAKE,WAAL,GAAmBR,EAAE,CAACM,EAAH,EAAnB;IACA,KAAKG,aAAL,GAAqBT,EAAE,CAACM,EAAH,EAArB;EACH,CAVI;EAYLI,cAAc,EAAE,wBAAUC,OAAV,EAAmBC,YAAnB,EAAiCC,aAAjC,EAAgD;IAC5D,IAAIC,KAAK,GAAG,KAAKC,YAAjB;IAEA,IAAIC,SAAS,GAAGH,aAAa,CAACI,IAA9B;IACA,IAAIC,YAAY,GAAGN,YAAY,CAACK,IAAhC;IAEA,IAAIE,aAAa,GAAGR,OAAO,CAACS,gBAAR,EAApB;IACA,IAAIC,MAAM,GAAGF,aAAa,CAACE,MAA3B;IAEA,IAAIhB,gBAAgB,GAAG,KAAKA,gBAA5B;IACA,IAAIE,aAAa,GAAG,KAAKA,aAAzB;IACA,IAAIC,WAAW,GAAG,KAAKA,WAAvB;IACA,IAAIC,aAAa,GAAG,KAAKA,aAAzB,CAZ4D,CAc5D;;IACA,KAAK,IAAIa,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,MAAM,CAACE,MAA3B,EAAmCD,CAAC,EAApC,EAAwC;MACpCJ,YAAY,CAACM,+BAAb,CAA8CH,MAAM,CAACC,CAAD,CAApD,EAAyDjB,gBAAzD;MACAW,SAAS,CAACQ,+BAAV,CAA2CH,MAAM,CAACC,CAAD,CAAjD,EAAsDf,aAAtD;MACAW,YAAY,CAACO,cAAb,CAA6BlB,aAAa,CAACmB,OAAd,CAAsBrB,gBAAtB,CAA7B,EAAsEG,WAAtE;MAEA,IAAKA,WAAW,CAACmB,CAAZ,GAAgB,CAAC,EAAtB,EAA2B;QACvB,OADJ,CACa;MADb,KAEK,IAAKnB,WAAW,CAACmB,CAAZ,GAAgB,EAArB,EAA0B;QAAE;QAC7B;QACAT,YAAY,CAACU,aAAb,CAA4BP,MAAM,CAACC,CAAD,CAAlC,EAAuCb,aAAvC;QACA,IAAIoB,aAAa,GAAGjB,YAAY,CAACkB,OAAb,GAAuBC,MAAvB,GAAgC,CAApD,CAH2B,CAG6B;;QACxD,IAAKtB,aAAa,CAACkB,CAAd,GAAkBE,aAAa,GAAG,MAAI,EAA3C,EACI,OALuB,CAKd;MAChB,CANI,MAOA,CACD;MACH;IACJ,CAhC2D,CAkC5D;;;IACAlB,OAAO,CAACqB,QAAR,GAAmB,IAAnB;EACH,CAhDI,CAkDL;EACA;EAEA;;AArDK,CAAT","sourceRoot":"/","sourcesContent":["// http://www.iforce2d.net/b2dtut/one-way-walls\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {    },\n\n    onLoad: function () {\n        this.pointVelPlatform = cc.v2();\n        this.pointVelOther = cc.v2();\n        this.relativeVel = cc.v2();\n        this.relativePoint = cc.v2();\n    },\n\n    onBeginContact: function (contact, selfCollider, otherCollider) {\n        let cache = this._pointsCache;\n\n        let otherBody = otherCollider.body;\n        let platformBody = selfCollider.body;\n\n        let worldManifold = contact.getWorldManifold();\n        let points = worldManifold.points;\n\n        let pointVelPlatform = this.pointVelPlatform;\n        let pointVelOther = this.pointVelOther;\n        let relativeVel = this.relativeVel;\n        let relativePoint = this.relativePoint;\n\n        //check if contact points are moving into platform\n        for (let i = 0; i < points.length; i++) {\n            platformBody.getLinearVelocityFromWorldPoint( points[i], pointVelPlatform );\n            otherBody.getLinearVelocityFromWorldPoint( points[i], pointVelOther );\n            platformBody.getLocalVector( pointVelOther.subSelf(pointVelPlatform), relativeVel );\n            \n            if ( relativeVel.y < -32 ) //if moving down faster than 32 pixel/s (1m/s), handle as before\n                return;  //point is moving into platform, leave contact solid and exit\n            else if ( relativeVel.y < 32 ) { //if moving slower than 32 pixel/s (1m/s)\n                //borderline case, moving only slightly out of platform\n                platformBody.getLocalPoint( points[i], relativePoint );\n                let platformFaceY = selfCollider.getAABB().height / 2;  //front of platform, should only used on a box collider\n                if ( relativePoint.y > platformFaceY - 0.1*32 )\n                    return;  //contact point is less than 3.2pixel (10cm) inside front face of platfrom\n            }\n            else {\n                //moving up faster than 1 m/s\n            }\n        }\n        \n        // store disabled state to contact\n        contact.disabled = true;\n    },\n\n    // called every frame, uncomment this function to activate update callback\n    // update: function (dt) {\n\n    // },\n});\n"]}