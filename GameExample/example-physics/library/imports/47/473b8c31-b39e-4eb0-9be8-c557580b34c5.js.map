{"version":3,"sources":["assets/start-scene/scripts/Global/SceneList.js"],"names":["cc","Class","Component","properties","itemPrefab","type","Prefab","initItemCount","scrollView","ScrollView","bufferZone","createItem","x","y","name","url","item","instantiate","itemComp","getComponent","label","string","node","addChild","init","menu","sceneList","itemList","updateTimer","updateInterval","lastContentPosY","initList","scenes","game","_sceneInfos","dict","i","j","length","dirname","path","replace","scenename","basename","log","dirs","Object","keys","sort","push","scenenames","height","itemInfo","updateItem","getPositionInView","worldPos","parent","convertToWorldSpaceAR","position","viewPos","convertToNodeSpaceAR","update","dt","items","buffer","isDown","curItemCount","offset","itemNode","newIdx","index","newInfo"],"mappings":"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","sourceRoot":"/","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        itemPrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n        initItemCount: 0,\n        scrollView: cc.ScrollView,\n        bufferZone: 0, // when item is away from bufferZone, we relocate it\n    },\n\n    createItem: function (x, y, name, url) {\n        var item = cc.instantiate(this.itemPrefab);\n        var itemComp = item.getComponent('ListItem');\n        var label = itemComp.label;\n        label.string = name;\n\n        if (url) {\n            itemComp.url = url;\n        }\n\n        // item.width = w;\n        item.x = x;\n        item.y = y;\n        this.node.addChild(item);\n        return item;\n    },\n\n    init (menu) {\n        this.menu = menu;\n        this.sceneList = [];\n        this.itemList = [];\n        this.updateTimer = 0;\n        this.updateInterval = 0.2;\n        this.lastContentPosY = 0; // use this variable to detect if we are scrolling up or down\n        this.initList();\n    },\n\n    // use this for initialization\n    initList () {\n        var scenes = cc.game._sceneInfos;\n        var dict = {};\n\n        if (scenes) {\n            var i, j;\n            for (i = 0; i < scenes.length; ++i) {\n                let url = scenes[i].url;\n                let dirname = cc.path.dirname(url).replace('db://assets/cases/', '');\n                if (dirname === 'db://assets/resources/test assets') {\n                    continue;\n                }\n                let scenename = cc.path.basename(url, '.fire');\n                if (scenename === 'TestList') continue;\n\n                if (!dirname) dirname = '_root';\n                if (!dict[dirname]) {\n                    dict[dirname] = {};\n                }\n                dict[dirname][scenename] = url;\n            }\n\n        } else {\n            cc.log('failed to get scene list!');\n        }\n        // compile scene dict to an array\n        let dirs = Object.keys(dict);\n        dirs.sort();\n        for (let i = 0; i < dirs.length; ++i) {\n            this.sceneList.push({\n                name: dirs[i],\n                url: null\n            });\n            let scenenames = Object.keys(dict[dirs[i]]);\n            scenenames.sort();\n            for (let j = 0; j < scenenames.length; ++j) {\n                let name = scenenames[j];\n                this.sceneList.push({\n                    name: name,\n                    url: dict[dirs[i]][name]\n                });\n            }\n        }\n        let y = 0;\n        this.node.height = (this.sceneList.length + 1) * 50;\n        for (let i = 0; i < this.initItemCount; ++i) {\n            let item = cc.instantiate(this.itemPrefab).getComponent('ListItem');\n            let itemInfo = this.sceneList[i];\n            item.init(this.menu);\n            this.node.addChild(item.node);\n            y -= 50;\n            item.updateItem (i, y, itemInfo.name, itemInfo.url);\n            this.itemList.push(item);\n        }\n    },\n\n    getPositionInView: function (item) { // get item position in scrollview's node space\n        let worldPos = item.parent.convertToWorldSpaceAR(item.position);\n        let viewPos = this.scrollView.node.convertToNodeSpaceAR(worldPos);\n        return viewPos;\n    },\n\n    update (dt) {\n        this.updateTimer += dt;\n        if (this.updateTimer < this.updateInterval) {\n            return; // we don't need to do the math every frame\n        }\n        this.updateTimer = 0;\n        let items = this.itemList;\n        let buffer = this.bufferZone;\n        let isDown = this.node.y < this.lastContentPosY; // scrolling direction\n        let curItemCount = this.itemList.length;\n        let offset = 50 * curItemCount;\n        for (let i = 0; i < curItemCount; ++i) {\n            let item = items[i];\n            let itemNode = item.node;\n            let viewPos = this.getPositionInView(itemNode);\n            if (isDown) {\n                // if away from buffer zone and not reaching top of content\n                if (viewPos.y < -buffer && itemNode.y + offset < 0) {\n                    let newIdx = item.index - curItemCount;\n                    let newInfo = this.sceneList[newIdx];\n                    item.updateItem(newIdx, itemNode.y + offset, newInfo.name, newInfo.url );\n                }\n            } else {\n                // if away from buffer zone and not reaching bottom of content\n                if (viewPos.y > buffer && itemNode.y - offset > -this.node.height) {\n                    let newIdx = item.index + curItemCount;\n                    let newInfo = this.sceneList[newIdx];\n                    item.updateItem(newIdx, itemNode.y - offset, newInfo.name, newInfo.url);\n                }\n            }\n        }\n        // update lastContentPosY\n        this.lastContentPosY = this.node.y;\n    },\n});\n"]}