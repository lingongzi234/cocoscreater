{"version":3,"sources":["assets/scripts/PointLightCtrlComponent.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAAM,IAAA,KAAwB,EAAE,CAAC,UAAU,EAAnC,OAAO,aAAA,EAAE,QAAQ,cAAkB,CAAC;AAG5C;IAAqD,2CAAY;IAAjE;QAAA,qEAoDC;QAnDW,oBAAc,GAAkB,IAAI,aAAa,EAAE,CAAC;;IAmDhE,CAAC;IAjDG,0CAAQ,GAAR;QACI,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,WAAW,EAAE,IAAI,CAAC,aAAa,EAAE,IAAI,CAAC,CAAC;QACtE,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,UAAU,EAAE,IAAI,CAAC,YAAY,EAAE,IAAI,CAAC,CAAC;QACpE,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,oBAAoB,EAAE,IAAI,CAAC,iBAAiB,EAAE,IAAI,CAAC,CAAC;IACrE,CAAC;IAED,2CAAS,GAAT;QACI,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,WAAW,EAAE,IAAI,CAAC,aAAa,EAAE,IAAI,CAAC,CAAC;QACvE,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,UAAU,EAAE,IAAI,CAAC,YAAY,EAAE,IAAI,CAAC,CAAC;QACrE,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,oBAAoB,EAAE,IAAI,CAAC,iBAAiB,EAAE,IAAI,CAAC,CAAC;IACtE,CAAC;IAEO,+CAAa,GAArB,UAAsB,KAA0B;QAC5C,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC;IAC7B,CAAC;IAEO,8CAAY,GAApB,UAAqB,KAA0B;QAC3C,IAAI,sBAAsB,GAAG,KAAK,CAAC,WAAW,EAAE,CAAC;QACjD,IAAI,qBAAqB,GAAG,IAAI,CAAC,IAAI,CAAC,oBAAoB,CAAC,sBAAsB,CAAC,CAAC;QAEnF,uBAAuB;QACvB,mBAAmB;QACnB,IAAI,CAAC,cAAc,CAAC,WAAW,GAAG,EAAE,CAAC,EAAE,CACnC,IAAI,CAAC,IAAI,CAAC,OAAO,GAAG,qBAAqB,CAAC,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,KAAK,EAC7D,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,GAAG,qBAAqB,CAAC,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CACvE,CAAC;QAEF,IAAI,CAAC,eAAe,EAAE,CAAC;IAC3B,CAAC;IAEO,mDAAiB,GAAzB,UAA0B,aAA4B;QAClD,IAAI,CAAC,cAAc,CAAC,WAAW,GAAG,aAAa,CAAC,WAAW,CAAC;QAC5D,IAAI,CAAC,cAAc,CAAC,MAAM,GAAG,aAAa,CAAC,MAAM,CAAC;QAClD,IAAI,CAAC,cAAc,CAAC,SAAS,GAAG,aAAa,CAAC,SAAS,CAAC;QACxD,IAAI,CAAC,cAAc,CAAC,SAAS,GAAG,aAAa,CAAC,SAAS,CAAC;QACxD,IAAI,CAAC,eAAe,EAAE,CAAC;IAC3B,CAAC;IAEO,iDAAe,GAAvB;QAAA,iBAUC;QATG,IAAI,CAAC,aAAa,CAAC,EAAE,CAAC,eAAe,CAAC,CAAC,OAAO,CAAC,UAAA,eAAe;YAC1D,IAAI,QAAQ,GAAgB,eAAe,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC;YAC3D,QAAQ,CAAC,WAAW,CAAC,aAAa,EAAE,KAAI,CAAC,cAAc,CAAC,WAAW,CAAC,CAAC;YACrE,QAAQ,CAAC,WAAW,CAAC,aAAa,EAAE,KAAI,CAAC,cAAc,CAAC,WAAW,CAAC,CAAC;YACrE,QAAQ,CAAC,WAAW,CAAC,QAAQ,EAAE,KAAI,CAAC,cAAc,CAAC,MAAM,CAAC,CAAC;YAC3D,QAAQ,CAAC,WAAW,CAAC,WAAW,EAAE,KAAI,CAAC,cAAc,CAAC,SAAS,CAAC,CAAC;YACjE,QAAQ,CAAC,WAAW,CAAC,WAAW,EAAE,KAAI,CAAC,cAAc,CAAC,SAAS,CAAC,CAAC;YACjE,eAAe,CAAC,WAAW,CAAC,CAAC,EAAE,QAAQ,CAAC,CAAC;QAC7C,CAAC,CAAC,CAAC;IACP,CAAC;IAnDgB,uBAAuB;QAD3C,OAAO;OACa,uBAAuB,CAoD3C;IAAD,8BAAC;CApDD,AAoDC,CApDoD,EAAE,CAAC,SAAS,GAoDhE;kBApDoB,uBAAuB;AAsD5C;IAAA;QACI;;WAEG;QACH,gBAAW,GAAa,EAAE,CAAC,KAAK,CAAC,MAAM,CAAC;QAExC;;WAEG;QACH,gBAAW,GAAY,EAAE,CAAC,EAAE,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;QAEvC;;WAEG;QACH,WAAM,GAAW,GAAG,CAAC;QAErB;;WAEG;QACH,cAAS,GAAY,IAAI,CAAC;QAE1B;;WAEG;QACH,cAAS,GAAY,KAAK,CAAC;IAC/B,CAAC;IAAD,oBAAC;AAAD,CAzBA,AAyBC,IAAA;AAzBY,sCAAa","file":"","sourceRoot":"/","sourcesContent":["const { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class PointLightCtrlComponent extends cc.Component {\n    private _pointLightUBO: PointLightUBO = new PointLightUBO();\n\n    onEnable() {\n        this.node.on(cc.Node.EventType.TOUCH_START, this._onTouchStart, this);\n        this.node.on(cc.Node.EventType.TOUCH_MOVE, this._onTouchMove, this);\n        this.node.on(\"on_property_change\", this._onPropertyChange, this);\n    }\n\n    onDisable() {\n        this.node.off(cc.Node.EventType.TOUCH_START, this._onTouchStart, this);\n        this.node.off(cc.Node.EventType.TOUCH_MOVE, this._onTouchMove, this);\n        this.node.off(\"on_property_change\", this._onPropertyChange, this);\n    }\n\n    private _onTouchStart(event: cc.Event.EventTouch) {\n        this._onTouchMove(event);\n    }\n\n    private _onTouchMove(event: cc.Event.EventTouch) {\n        let touchPointInWorldSpace = event.getLocation();\n        let touchPointInNodeSpace = this.node.convertToNodeSpaceAR(touchPointInWorldSpace);\n\n        // 将触摸点转换为OPENGL坐标系并归一化\n        // OpenGl 坐标系原点在左上角\n        this._pointLightUBO.centerPoint = cc.v2(\n            this.node.anchorX + touchPointInNodeSpace.x / this.node.width,\n            1 - (this.node.anchorY + touchPointInNodeSpace.y / this.node.height)\n        );\n\n        this._updateMaterial();\n    }\n\n    private _onPropertyChange(pointLightUBO: PointLightUBO) {\n        this._pointLightUBO.centerColor = pointLightUBO.centerColor;\n        this._pointLightUBO.radius = pointLightUBO.radius;\n        this._pointLightUBO.cropAlpha = pointLightUBO.cropAlpha;\n        this._pointLightUBO.enableFog = pointLightUBO.enableFog;\n        this._updateMaterial();\n    }\n\n    private _updateMaterial() {\n        this.getComponents(cc.RenderComponent).forEach(renderComponent => {\n            let material: cc.Material = renderComponent.getMaterial(0);\n            material.setProperty(\"centerColor\", this._pointLightUBO.centerColor);\n            material.setProperty(\"centerPoint\", this._pointLightUBO.centerPoint);\n            material.setProperty(\"radius\", this._pointLightUBO.radius);\n            material.setProperty(\"cropAlpha\", this._pointLightUBO.cropAlpha);\n            material.setProperty(\"enableFog\", this._pointLightUBO.enableFog);\n            renderComponent.setMaterial(0, material);\n        });\n    }\n}\n\nexport class PointLightUBO {\n    /**\n     * 中心点颜色\n     */\n    centerColor: cc.Color = cc.Color.YELLOW;\n\n    /**\n     * 中心点坐标 ([0.0, 1.0], [0.0, 1.0])\n     */\n    centerPoint: cc.Vec2 = cc.v2(0.5, 0.5);\n\n    /**\n     * 扩散半径 [0.0, 1.0]\n     */\n    radius: number = 0.5;\n\n    /**\n     * 是否裁剪掉透明区域上的点光\n     */\n    cropAlpha: boolean = true;\n\n    /**\n     * 是否开启战争迷雾效果\n     */\n    enableFog: boolean = false;\n}\n"]}