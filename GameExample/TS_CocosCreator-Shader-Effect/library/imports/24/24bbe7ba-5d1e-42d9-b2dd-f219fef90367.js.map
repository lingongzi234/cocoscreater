{"version":3,"sources":["assets/scripts/RoundCornerCropV2EffectScene.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["const { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class RoundCornerCropV2EffectScene extends cc.Component {\n    private _radiuSlider: cc.Slider = null;\n    private _radiuLabel: cc.Label = null;\n\n    private _examplesParentNode: cc.Node = null;\n\n    onLoad() {\n        // 关闭动态合图\n        cc.dynamicAtlasManager.enabled = false;\n\n        this._radiuSlider = cc.find(\"Canvas/Content/Controller/RadiusSlider/Slider\").getComponent(cc.Slider);\n        this._radiuLabel = cc.find(\"Canvas/Content/Controller/RadiusSlider/ValueLabel\").getComponent(cc.Label);\n\n        this._examplesParentNode = cc.find(\"Canvas/Content/Examples\");\n    }\n\n    onEnable() {\n        this._radiuSlider.node.on(\"slide\", this._onSliderChanged, this);\n    }\n\n    onDisable() {\n        this._radiuSlider.node.off(\"slide\", this._onSliderChanged, this);\n    }\n\n    start() {\n        this._onSliderChanged();\n    }\n\n    private _onSliderChanged() {\n        // 计算半径px\n        let radiusInPx = Math.floor(100 * this._radiuSlider.progress);\n        this._radiuLabel.string = radiusInPx + \"\";\n\n        // 更新材质\n        this._updateRenderComponentMaterial({\n            radiusInPx: radiusInPx\n        });\n    }\n\n    /**\n     * 更新渲染组件的材质\n     *\n     * 1. 获取材质\n     * 2. 给材质的 unitform 变量赋值\n     * 3. 重新将材质赋值回去\n     */\n    private _updateRenderComponentMaterial(param: {\n        /**\n         * 圆角半径px\n         */\n        radiusInPx: number;\n    }) {\n        this._examplesParentNode.children.forEach(childNode => {\n            childNode.getComponents(cc.RenderComponent).forEach(renderComponent => {\n                // 计算半径px分别相对于纹理宽高的比例（也叫归一化）\n                let xRadiux = param.radiusInPx / childNode.width;\n                // 约束范围在区间 [0.0, 0.5]\n                xRadiux = xRadiux >= 0.5 ? 0.5 : xRadiux;\n\n                let yRadius = param.radiusInPx / childNode.height;\n                yRadius = yRadius >= 0.5 ? 0.5 : yRadius;\n\n                if (childNode.name === \"Rectangle1\") cc.log(`${childNode.name} : (${xRadiux}, ${yRadius})`);\n\n                // 更新材质\n                let material: cc.Material = renderComponent.getMaterial(0);\n\n                // 圆角x轴半径长度（相对于纹理宽度）[0.0, 0.5]\n                material.setProperty(\"xRadius\", xRadiux);\n\n                // 圆角y轴半径长度（相对于纹理高度）[0.0, 0.5]\n                material.setProperty(\"yRadius\", yRadius);\n                renderComponent.setMaterial(0, material);\n            });\n        });\n    }\n}\n"]}