{"version":3,"sources":["assets/scripts/FlashLightCtrlComponent.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["const { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class FlashLightCtrlComponent extends cc.Component {\n    private _flashLightUBO: FlashLightUBO = new FlashLightUBO();\n\n    onEnable() {\n        this.node.on(cc.Node.EventType.TOUCH_START, this._onTouchStart, this);\n        this.node.on(cc.Node.EventType.TOUCH_MOVE, this._onTouchMove, this);\n        this.node.on(\"on_property_change\", this._onPropertyChange, this);\n    }\n\n    onDisable() {\n        this.node.off(cc.Node.EventType.TOUCH_START, this._onTouchStart, this);\n        this.node.off(cc.Node.EventType.TOUCH_MOVE, this._onTouchMove, this);\n        this.node.off(\"on_property_change\", this._onPropertyChange, this);\n    }\n\n    private _onTouchStart(event: cc.Event.EventTouch) {\n        this._onTouchMove(event);\n    }\n\n    private _onTouchMove(event: cc.Event.EventTouch) {\n        let touchPointInWorldSpace = event.getLocation();\n        let touchPointInNodeSpace = this.node.convertToNodeSpaceAR(touchPointInWorldSpace);\n\n        // 将触摸点转换为OPENGL坐标系并归一化\n        // OpenGl 坐标系原点在左上角\n        this._flashLightUBO.lightCenterPoint = cc.v2(\n            this.node.anchorX + touchPointInNodeSpace.x / this.node.width,\n            1 - (this.node.anchorY + touchPointInNodeSpace.y / this.node.height)\n        );\n\n        this._updateMaterial();\n    }\n\n    private _onPropertyChange(localDiffusionUniform: FlashLightUBO) {\n        this._flashLightUBO.lightColor = localDiffusionUniform.lightColor;\n        this._flashLightUBO.lightAngle = localDiffusionUniform.lightAngle;\n        this._flashLightUBO.lightWidth = localDiffusionUniform.lightWidth;\n        this._flashLightUBO.enableGradient = localDiffusionUniform.enableGradient;\n        this._flashLightUBO.cropAlpha = localDiffusionUniform.cropAlpha;\n        this._flashLightUBO.enableFog = localDiffusionUniform.enableFog;\n        this._updateMaterial();\n    }\n\n    private _updateMaterial() {\n        this.getComponents(cc.RenderComponent).forEach(renderComponent => {\n            let material: cc.Material = renderComponent.getMaterial(0);\n            material.setProperty(\"lightColor\", this._flashLightUBO.lightColor);\n            material.setProperty(\"lightCenterPoint\", this._flashLightUBO.lightCenterPoint);\n            material.setProperty(\"lightAngle\", this._flashLightUBO.lightAngle);\n            material.setProperty(\"lightWidth\", this._flashLightUBO.lightWidth);\n            material.setProperty(\"enableGradient\", this._flashLightUBO.enableGradient);\n            material.setProperty(\"cropAlpha\", this._flashLightUBO.cropAlpha);\n            material.setProperty(\"enableFog\", this._flashLightUBO.enableFog);\n            renderComponent.setMaterial(0, material);\n        });\n    }\n}\n\nexport class FlashLightUBO {\n    /**\n     * 中心点颜色\n     */\n    lightColor: cc.Color = cc.Color.YELLOW;\n\n    /**\n     * 中心点坐标 ([0.0, 1.0], [0.0, 1.0])\n     */\n    lightCenterPoint: cc.Vec2 = cc.v2(0.5, 0.5);\n\n    /**\n     * 光束角度 [0.0, 180.0]\n     */\n    lightAngle: number = 45;\n\n    /**\n     * 光束宽度 [0.0, +∞]\n     */\n    lightWidth: number = 0.5;\n\n    /**\n     * 是否启用光束渐变\n     */\n    enableGradient: boolean = true;\n\n    /**\n     * 是否裁剪掉透明区域上的点光\n     */\n    cropAlpha: boolean = true;\n\n    /**\n     * 是否开启战争迷雾效果\n     */\n    enableFog: boolean = false;\n}\n"]}