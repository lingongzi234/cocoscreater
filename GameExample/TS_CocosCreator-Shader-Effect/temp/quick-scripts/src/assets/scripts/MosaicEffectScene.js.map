{"version":3,"sources":["assets/scripts/MosaicEffectScene.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["const { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class MosaicEffectScene extends cc.Component {\n    private _xMosaicCountSlider: cc.Slider = null;\n    private _xMosaicCountSliderLabel: cc.Label = null;\n    private _yMosaicCountSlider: cc.Slider = null;\n    private _yMosaicCountSliderLabel: cc.Label = null;\n    private _mosaicCountSlider: cc.Slider = null;\n    private _mosaicCountSliderLabel: cc.Label = null;\n\n    private _examplesParentNode: cc.Node = null;\n\n    onLoad() {\n        // 关闭动态合图\n        cc.dynamicAtlasManager.enabled = false;\n\n        this._xMosaicCountSlider = cc.find(\"Canvas/Content/Sliders/XMosaicCountSlider/Slider\").getComponent(cc.Slider);\n        this._xMosaicCountSliderLabel = cc.find(\"Canvas/Content/Sliders/XMosaicCountSlider/ValueLabel\").getComponent(cc.Label);\n        this._yMosaicCountSlider = cc.find(\"Canvas/Content/Sliders/YMosaicCountSlider/Slider\").getComponent(cc.Slider);\n        this._yMosaicCountSliderLabel = cc.find(\"Canvas/Content/Sliders/YMosaicCountSlider/ValueLabel\").getComponent(cc.Label);\n        this._mosaicCountSlider = cc.find(\"Canvas/Content/Sliders/MosaicCountSlider/Slider\").getComponent(cc.Slider);\n        this._mosaicCountSliderLabel = cc.find(\"Canvas/Content/Sliders/MosaicCountSlider/ValueLabel\").getComponent(cc.Label);\n\n        this._examplesParentNode = cc.find(\"Canvas/Content/Examples\");\n    }\n\n    onEnable() {\n        this._xMosaicCountSlider.node.on(\"slide\", this._onSliderChanged, this);\n        this._yMosaicCountSlider.node.on(\"slide\", this._onSliderChanged, this);\n        this._mosaicCountSlider.node.on(\"slide\", this._onSliderChangedTogether, this);\n    }\n\n    onDisable() {\n        this._xMosaicCountSlider.node.off(\"slide\", this._onSliderChanged, this);\n        this._yMosaicCountSlider.node.off(\"slide\", this._onSliderChanged, this);\n        this._mosaicCountSlider.node.off(\"slide\", this._onSliderChangedTogether, this);\n    }\n\n    start() {\n        this._onSliderChanged();\n    }\n\n    private _onSliderChangedTogether() {\n        let mosaicCount = Math.round(this._mosaicCountSlider.progress * 300);\n        this._mosaicCountSliderLabel.string = `${mosaicCount}`;\n\n        // 更新材质\n        this._updateRenderComponentMaterial({\n            xBlockCount: mosaicCount,\n            yBlockCount: mosaicCount\n        });\n    }\n\n    private _onSliderChanged() {\n        let xMosaicCount = Math.round(this._xMosaicCountSlider.progress * 300);\n        this._xMosaicCountSliderLabel.string = `${xMosaicCount}`;\n\n        let yMosaicCount = Math.round(this._yMosaicCountSlider.progress * 300);\n        this._yMosaicCountSliderLabel.string = `${yMosaicCount}`;\n\n        // 更新材质\n        this._updateRenderComponentMaterial({\n            xBlockCount: xMosaicCount,\n            yBlockCount: yMosaicCount\n        });\n    }\n\n    /**\n     * 更新渲染组件的材质\n     *\n     * 1. 获取材质\n     * 2. 给材质的 unitform 变量赋值\n     * 3. 重新将材质赋值回去\n     */\n    private _updateRenderComponentMaterial(param: {\n        /**\n         * X轴方块数量 [1.0, 正无穷]\n         */\n        xBlockCount: number;\n\n        /**\n         * Y轴方块数量 [1.0, 正无穷]\n         */\n        yBlockCount: number;\n    }) {\n        this._examplesParentNode.children.forEach(childNode => {\n            childNode.getComponents(cc.RenderComponent).forEach(renderComponent => {\n                let material: cc.Material = renderComponent.getMaterial(0);\n                material.setProperty(\"xBlockCount\", param.xBlockCount);\n                material.setProperty(\"yBlockCount\", param.yBlockCount);\n                renderComponent.setMaterial(0, material);\n            });\n        });\n    }\n}\n"]}