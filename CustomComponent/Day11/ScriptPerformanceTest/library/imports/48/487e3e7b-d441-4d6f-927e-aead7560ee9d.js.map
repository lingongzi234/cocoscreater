{"version":3,"sources":["assets/Script/optimize/BallLineTestOptimize.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import GameControl from \"../GameControl\";\nimport LineRectTestOptimize from \"./LineRectTestOptimize\";\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class BallLineTestOptimize extends cc.Component {\n\n    v: cc.Node = null;\n\n    h: cc.Node = null;\n\n    graphics: cc.Graphics = null;\n\n    vPos1: cc.Vec2 = new cc.Vec2(0, 0);\n    vPos2: cc.Vec2 = new cc.Vec2(0, 0);\n    hPos1: cc.Vec2 = new cc.Vec2(0, 0);\n    hPos2: cc.Vec2 = new cc.Vec2(0, 0);\n    v1DrawPos: cc.Vec3 = new cc.Vec3(0, 0);\n    v2DrawPos: cc.Vec3 = new cc.Vec3(0, 0);\n    h1DrawPos: cc.Vec3 = new cc.Vec3(0, 0);\n    h2DrawPos: cc.Vec3 = new cc.Vec3(0, 0);\n\n    r0PosTemp: cc.Vec2 = new cc.Vec2(0, 0);\n    r1PosTemp: cc.Vec2 = new cc.Vec2(0, 0);\n    r2PosTemp: cc.Vec2 = new cc.Vec2(0, 0);\n    r3PosTemp: cc.Vec2 = new cc.Vec2(0, 0);\n\n    ballID: number = 0;\n\n    _waitTime: number = 0;\n\n    graphicsPool: cc.Node = null;\n\n    _gameControl: GameControl = null;\n\n    onLoad () {\n        this.v = cc.find(\"Canvas/V\");\n        this.h = cc.find(\"Canvas/H\");\n        this.graphicsPool = cc.find(\"Canvas/graphicsPool\");\n        this.graphics = this.graphicsPool.children[this.ballID].getComponent(cc.Graphics);\n        this._gameControl = cc.find(\"Canvas\").getComponent(GameControl);\n        // this.node.getComponent(cc.Animation).defaultClip.speed = 0.7;\n    }\n\n    update(deltaTime: number) {\n        if (!this.v || !this.h || !this.graphics) return;\n\n        if (this._waitTime === 0) {\n            var nodeAABB = this.node.getBoundingBoxToWorld();\n            this.updateGraphicsColor();\n            this.graphics.clear();\n            this.vLineTest(nodeAABB);\n            this.hLineTest(nodeAABB);\n            this._waitTime++;\n        } else if (this._waitTime < this._gameControl.waitFrames) {\n            this._waitTime++;\n        } else {\n            this._waitTime = 0;\n        }\n    }\n\n    updateGraphicsColor () {\n        this.graphics.strokeColor.r = Math.floor(Math.random() * 256);\n        this.graphics.strokeColor.g = Math.floor(Math.random() * 256);\n        this.graphics.strokeColor.b = Math.floor(Math.random() * 256);\n    }\n\n    vLineTest (nodeAABB) {\n        for (var i = 0; i < this.v.children.length; i++) {\n            var v1NodePos = this.v.children[i].children[0].position;\n            var v1WorldPos = this.v.children[i].convertToWorldSpaceAR(v1NodePos);\n            this.v1DrawPos = this.graphicsPool.convertToNodeSpaceAR(v1WorldPos);\n\n            var v2NodePos = this.v.children[i].children[1].position;\n            var v2WorldPos = this.v.children[i].convertToWorldSpaceAR(v2NodePos);\n            this.v2DrawPos = this.graphicsPool.convertToNodeSpaceAR(v2WorldPos);\n\n            this.vPos1.x = v1WorldPos.x;\n            this.vPos1.y = v1WorldPos.y;\n            this.vPos2.x = v2WorldPos.x;\n            this.vPos2.y = v2WorldPos.y;\n\n            this.doTest(this.vPos1, this.vPos2, this.v1DrawPos, this.v2DrawPos, nodeAABB);\n        }\n    }\n\n    hLineTest (nodeAABB) {\n        for (var i = 0; i < this.h.children.length; i++) {\n            var h1NodePos = this.h.children[i].children[0].position;\n            var h1WorldPos = this.h.children[i].convertToWorldSpaceAR(h1NodePos);\n            this.h1DrawPos = this.graphicsPool.convertToNodeSpaceAR(h1WorldPos);\n\n            var h2NodePos = this.h.children[i].children[1].position;\n            var h2WorldPos = this.h.children[i].convertToWorldSpaceAR(h2NodePos);\n            this.h2DrawPos = this.graphicsPool.convertToNodeSpaceAR(h2WorldPos);\n\n            this.hPos1.x = h1WorldPos.x;\n            this.hPos1.y = h1WorldPos.y;\n            this.hPos2.x = h2WorldPos.x;\n            this.hPos2.y = h2WorldPos.y;\n\n            this.doTest(this.hPos1, this.hPos2, this.h1DrawPos, this.h2DrawPos, nodeAABB);\n        }\n    }\n\n    doTest (p1, p2, d1, d2, nodeAABB) {\n        if (LineRectTestOptimize.lineRect(p1, p2, nodeAABB)) {\n            this.drawLine(d1, d2);\n        }\n    }\n\n    drawLine (d1, d2) {\n        this.graphics.moveTo(d1.x, d1.y);\n        this.graphics.lineTo(d2.x, d2.y);\n        this.graphics.stroke();\n    }\n}\n"]}